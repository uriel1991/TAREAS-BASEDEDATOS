CREATE TABLE DEVELOPER (ID_DEVELOPER INTEGER,NOMBRE VARCHAR2(120),EMAIL VARCHAR2(120),CONSTRAINT PK_ID_DEVELOPER PRIMARY KEY(ID_DEVELOPER));

CREATE TABLE TAREA(ID_TAREA INTEGER,ID_DEVELOPER INTEGER,DESCRIPCION VARCHAR2(500),COMPLETADA CHAR,PORCIERTO_COMPLETADA INTEGER,FECHAR DATE,CONSTRAINT PK_ID_TAREA PRIMARY KEY(ID_TAREA),CONSTRAINT FK_ID_DEVELOPER FOREIGN KEY(ID_DEVELOPER)REFERENCES DEVELOPER(ID_DEVELOPER));

CREATE SEQUENCE SECUENCIA_DEVELOPER
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE SEQUENCE SECUENCIA_TAREA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE PROCEDURE GUARDAR_DEVELOPER(MY_ID_DEVELOPER OUT INTEGER,MY_NOMBRE IN VARCHAR2,MY_EMAIL IN VARCHAR2)
AS
BEGIN
SELECT SECUENCIA_DEVELOPER.NEXTVAL INTO MY_ID_DEVELOPER FROM DUAL;
INSERT INTO DEVELOPER VALUES(MY_ID_DEVELOPER,MY_NOMBRE,MY_EMAIL);
END;
/

CREATE OR REPLACE PROCEDURE GUARDAR_TAREA(MY_ID_TAREA OUT INTEGER,MY_ID_DEVELOPER IN INTEGER,MY_DESCRIPCION IN VARCHAR2)
AS
BEGIN
SELECT SECUENCIA_TAREA.NEXTVAL INTO MY_ID_TAREA FROM DUAL;
INSERT INTO TAREA VALUES(MY_ID_TAREA,MY_ID_DEVELOPER,MY_DESCRIPCION,'N',0,SYSDATE);
END;
/



DECLARE
MY_ID_DEVELOPER INTEGER;
MY_ID_TAREA INTEGER;
BEGIN
GUARDAR_DEVELOPER(MY_ID_DEVELOPER, 'BRENDA', 'BRENDAGMAIL.COM');
GUARDAR_TAREA(MY_ID_TAREA, MY_ID_DEVELOPER, 'CREACION DE LA PAGINA WEB');

GUARDAR_DEVELOPER(MY_ID_DEVELOPER, 'JOSE OMAR', 'OMAR@YAHOO.COM');
GUARDAR_TAREA(MY_ID_TAREA, MY_ID_DEVELOPER, 'CREACION DE LAS TABLAS');

GUARDAR_DEVELOPER(MY_ID_DEVELOPER, 'VICTOR ANGEL', 'VICTOR@HOTMAIL.COM');
GUARDAR_TAREA(MY_ID_TAREA, MY_ID_DEVELOPER, 'ENCARGADO DE LA PROGRAMACION DE LOS PROCEDIMIENTOS');

GUARDAR_DEVELOPER(MY_ID_DEVELOPER, 'LESLYE', 'LESLIE@LIVE.COM');
GUARDAR_TAREA(MY_ID_TAREA, MY_ID_DEVELOPER, 'ENCARGADA DE LA PROGRAMACION DE LOS SERVICIOS WEB');
END;
/

SELECT * FROM DEVELOPER;
SELECT * FROM TAREA;

CREATE OR REPLACE PROCEDURE ACTUALIZAR_TAREA(MY_ID_TAREA IN INTEGER, MY_ID_DEVELOPER IN INTEGER, MY_PORCIERTO_COMPLETADA IN INTEGER)
AS
PORCENTAJE_RECIENTE INTEGER;
PORCENTAJE_SUMADO INTEGER;
BEGIN
SELECT PORCIERTO_COMPLETADA INTO PORCENTAJE_RECIENTE FROM TAREA WHERE ID_TAREA=MY_ID_TAREA;
PORCENTAJE_SUMADO := PORCENTAJE_RECIENTE + MY_PORCIERTO_COMPLETADA;
IF PORCENTAJE_SUMADO > 100 THEN
  RAISE_APPLICATION_ERROR(-20001, 'LO SIENTO EL PROCENTAJE ES MAYO DE 100% INTENTA OTRO VALOR');
END IF;
IF PORCENTAJE_SUMADO = 10 THEN
  UPDATE TAREA SET PORCIERTO_COMPLETADA=100, COMPLETADA='S',FECHAR=SYSDATE WHERE ID_TAREA=MY_ID_TAREA;
END IF;
UPDATE TAREA SET PORCIERTO_COMPLETADA=PORCENTAJE_SUMADO, FECHAR=SYSDATE WHERE ID_TAREA=MY_ID_TAREA;
END;

BEGIN
ACTUALIZAR_TAREA(1, 1, 30);
END;

BEGIN
ACTUALIZAR_TAREA(1, 1, 40);
END;

SELECT * FROM TAREA;

BEGIN
ACTUALIZAR_TAREA(2, 2, 40);
END;

BEGIN
ACTUALIZAR_TAREA(2, 2, 70);
END;

SELECT * FROM TAREA;

BEGIN
ACTUALIZAR_TAREA(2, 2, 60);
END;

SELECT * FROM TAREA;


